# GeoSense by inDrive (Flutter)

Мобильный прототип для Decentraton 4.0 на основе обезличенных геотреков.

Функции (P0 по спецификации geo_mvp_data_api_spec_p_0.md):
- Карта с теплокартой спроса (POST /api/v1/analytics/heatmap) и кластерами «горячих зон» (GET /api/v1/analytics/demand-zones)
- Экран аналитики:
  - Зоны высокого спроса (GET /api/v1/analytics/demand-zones)
  - Метрики эффективности (GET /api/v1/analytics/efficiency-metrics)
  - Популярные маршруты/коридоры (POST /api/v1/routes/analyze/popular)
- Экран ML:
  - Выявление аномалий (POST /api/v1/ml/detect-anomalies)
  - Статус моделей (GET /api/v1/ml/model-status)

Убраны из UI как вне P0: trip-patterns, comparative-analysis, safety-analysis (отдельным эндпоинтом), predict-demand, optimize-routes, retrain-models.

Дизайн: две переключаемые темы в стиле inDrive с кастомными цветами бренда:
- Акцентный зелёный: #C1F11D
- Доп. акцент серый: #939393
- Тема 1 (чёрная): фон/сёрфейс #141414
- Тема 2 (бело‑молочная): фон/сёрфейс #FFFEE9
- Типографика: Inter (Google Fonts) по всему приложению для аккуратной, современной читабельности
Переключатель темы доступен в AppBar (иконки луна/солнце). Единый верхний AppBar с логотипом; внутренние AppBar страниц убраны.

## Логотип

- В шапке приложения используется ваш логотип из `lib/images/unnamed.jpg` (путь фиксированный, без fallback).
- Убедитесь, что файл находится по этому пути и добавлен в pubspec.yaml (раздел assets уже настроен).
- После добавления файла выполните: `flutter pub get`. 

## Режим демо

Сейчас приложение ориентировано на красивый каркас без обязательной привязки к бэкенду.

- По умолчанию включён «Демо‑режим»: данные для карты, аналитики и ML генерируются локально для презентации.
- Переключатель демо находится в верхнем AppBar по центру (надпись «Демо» + переключатель). Вы можете в любой момент включать/выключать демо.
- Это позволяет показать прототип без запуска сервера.

Когда бэкенд будет готов, экраны начнут использовать API по адресу из Env.apiBase (по умолчанию 10.0.2.2:8000/localhost:8000).

## Запуск

Требования: Flutter 3.22+ (Dart 3.9+), iOS 14+/Android 6+, интернет.

1. Установить зависимости:
```
flutter pub get
```

2. Указать адрес бэкенда (по умолчанию Android-эмулятор 10.0.2.2:8000):
- Через флаг сборки:
```
flutter run --dart-define=API_BASE=http://10.0.2.2:8000
```
- Или редактируйте lib/core/env.dart

3. Запуск на Android эмуляторе:
```
flutter run -d emulator-5554 --dart-define=API_BASE=http://10.0.2.2:8000
```

4. Запуск на iOS симуляторе:
```
flutter run -d ios --dart-define=API_BASE=http://localhost:8000
```

## Конфиденциальность
- Приложение работает только с агрегированными данными (теплокарта/кластеры/метрики).
- Не отображаются персональные данные пассажиров/водителей/ТС.
- Для презентации используйте обезличенный датасет, обеспечьте пространственно-временное размытие на стороне бэкенда.

## Структура ключевых файлов
- lib/features/map/map_screen.dart — карта, теплокарта, кластеры спроса.
- lib/features/analytics/analytics_screen.dart — карточки метрик с просмотром JSON.
- lib/features/ml/ml_screen.dart — формы вызова ML эндпоинтов.
- lib/features/frontend/frontend_screen.dart — Дашборд (нативный Flutter, без WebView).
- lib/services/**/*.dart — слой API (Dio).
- lib/core/env.dart — базовый адрес API через dart-define.

## Известные моменты
- Для iOS добавлен ATS (NSAppTransportSecurity) для http во время разработки.
- Для Android включен cleartext и INTERNET permission.
- Если бэкенд недоступен, карта отрисует демо-точки для показа функционала.

## Идеи для «что дальше»
- Больше интерактива на карте (временной слайдер, сценарии изменения спроса).
- Подсказки водителям по релокации в «горячие зоны» в реальном времени.
- Интеграция погодных и событийных данных.
- Оффлайн-тайлы/кеш для демо без сети.
